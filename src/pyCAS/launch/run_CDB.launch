<?xml version="1.0" ?>
<launch>
  <!-- TODO: Clean up the map_file argument? -->
  <!-- TODO: Remove duplicate files within the CDB/CDB_robot directories -->
  <arg name="map_file" default="$(find pyCAS)/domains/CDB_robot/maps/campus_1.yaml" />
  <arg name="model" default="burger"/>
  <arg name="move_forward_only" default="false"/>

  <!-- TODO: Make sure the map parameters are converted to arguments -->
  <node pkg="pyCAS" type="CDB_execution_node.py" name="CDB_execution_node" output="screen">
    <param name="wait_duration" value="1" />
    <param name="timeout_duration" value="1000" />
    <param name="number_iterations" value="50" />
    <param name="obstacle_map" value="$(find pyCAS)/domains/CDB_robot/maps/obstacle_info.json" />
    <param name="grid_map" value="$(find pyCAS)/domains/CDB_robot/maps/tiny_map.txt" />
    <param name="topological_map" value="$(find pyCAS)/domains/CDB_robot/maps/map_info.json" />
  </node>

  <node pkg="pyCAS" type="robot_status_monitor.py" name="robot_status_monitor" output="screen">
    <param name="rate" value="10" />
  </node>
  
  <node pkg="pyCAS" type="obstacle_monitor.py" name="obstacle_monitor" output="screen">
    <param name="rate" value="10" />
  </node>

  <node pkg="pyCAS" type="ssp_state_monitor.py" name="ssp_state_monitor" output="screen">
    <param name="rate" value="10" />
  </node>

  <!-- include file="$(find turtlebot3_fake)/launch/turtlebot3_fake.launch">
    <arg name="model" value="$(arg model)" />
  </include> -->

  <param name="tb3_model" value="burger"/>

  <include file="$(find turtlebot3_bringup)/launch/includes/description.launch.xml">
    <arg name="model" value="$(arg model)" />
  </include>

  <node pkg="turtlebot3_fake" type="turtlebot3_fake_node" name="turtlebot3_fake_node" output="screen" />

  <node pkg="robot_state_publisher" type="robot_state_publisher" name="robot_state_publisher" output="screen">
    <param name="publish_frequency" type="double" value="50.0" />
  </node>

  <node pkg="fake_localization" type="fake_localization" name="fake_localization">
    <remap from="base_pose_ground_truth" to="odom" />
  </node>

  <node pkg="rviz" type="rviz" name="rviz" args="-d $(find pyCAS)/rviz/default.rviz" />

  <node pkg="map_server" name="map_server" type="map_server" args="$(arg map_file)"/>

  <!-- TODO: Verify that this is correct -->
  <include file="$(find turtlebot3_navigation)/launch/move_base.launch">
    <arg name="model" value="$(arg model)" />
    <arg name="move_forward_only" value="$(arg move_forward_only)"/>
    <!--<arg name="cmd_vel_topic" value="mobile_base/commands/velocity"/>-->
    <rosparam file="$(find turtlebot3_navigation)/param/costmap_common_params.yaml" command="load" ns="global_costmap" />
    <rosparam file="$(find turtlebot3_navigation)/param/costmap_common_params.yaml" command="load" ns="local_costmap" />
    <rosparam file="$(find turtlebot3_navigation)/param/local_costmap_params.yaml" command="load" />
    <rosparam file="$(find turtlebot3_navigation)/param/global_costmap_params.yaml" command="load" />
    <rosparam file="$(find turtlebot3_navigation)/param/dwa_local_planner_params.yaml" command="load" />
    <remap from="cmd_vel" to="mobile_base/commands/velocity"/>
  </include>
</launch>